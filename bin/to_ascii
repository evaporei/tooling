#!/usr/bin/env ruby
# frozen_string_literal: true

require_relative './utils.rb'

$raw = false

def main
  arguments = ARGV
  if !arguments.empty? && arguments[0] == '-r'
    $raw = true
    arguments = arguments[1..-1]
  end

  argument_reader(arguments) do |argument|
    process_input(argument)
  end
end

def process_input(input)
  chars = [input].pack('H*').chars.map do |x|
    if x =~ /[^[:print:]]/ && $raw
      "\\x#{char_to_hex(x)}"
    elsif x =~ /[^[:print:]]/ && !$raw
      '.'
    else
      x
    end
  end

  puts chars.join('')
end

def char_to_hex(input)
  out = input.ord.to_s(16)
  out = '0' + out if out.length.odd?

  out
end

main
